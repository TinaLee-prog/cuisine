<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¾²æ‘ç¾é£Ÿ</title>
    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="æ¢ç´¢åœ¨åœ°è¾²æ‘çš„å‚³çµ±ç¾é£Ÿï¼Œé«”é©—æœ€ç´”æ¨¸çš„å°ç£é¢¨å‘³ã€‚"
    />
    <meta
      name="keywords"
      content="è¾²æ‘ç¾é£Ÿ, å°ç£å°åƒ, å‚³çµ±æ–™ç†, åœ¨åœ°é¢¨å‘³, ç¾é£Ÿæ¨è–¦"
    />
    <meta name="author" content="Tina" />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <div>
        <div class="cloud cloud-bg1"></div>
        <h1 class="main-title">è¾²æ‘å°åƒç‰¹è‰²æ–™ç†</h1>
        <div class="cloud cloud-bg2"></div>
        <div class="cloud cloud-bg3"></div>
      </div>
      <div class="search-container">
        <div id="search">
          <div class="search-bar">
            <input
              type="text"
              id="searchInput"
              class="sInput"
              placeholder="è«‹è¼¸å…¥é¤å»³æˆ–åœ°å€..."
            />
            <button class="search-btn" onclick="searchDestination()">
              æœå°‹
            </button>
          </div>
        </div>
      </div>

      <div id="mydata">
        <div class="card">
          <!-- See below #mydata -->
          <!-- <img
            src="https://ezgo.ardswc.gov.tw/Uploads/opendata/TainmaMain01/APPLY_D/20151007173924.jpg"
          />
          <div class="card-body">
            <h3 class="card-title">æ¹–è“å®´é¤åŠ</h3>
            <p class="card-text">è‹—æ —ç¸£å¤§æ¹–é„‰å¯Œèˆˆæ‘å…«å¯®å½2-7è™Ÿ4æ¨“</p>
            <p class="card-text">037-995677</p>
          </div> -->
        </div>
      </div>
    </div>
    <!--container-->
  </body>
  <script src="./jquery-3.7.1.js"></script>
  <script>
    let allData = [];

    //Allow search on Enter key press
    $("#searchInput").keydown(function (e) {
      if (e.key === "Enter") {
        searchDestination();
      }
    });

    $("#searchInput").on("input", function () {
      let keyword = $(this).val().trim();
      if (keyword === "") {
        showData(allData);
      }
    });

    //ajax load data
    $.ajax({
      type: "GET",
      url: "https://data.moa.gov.tw/Service/OpenData/ODwsv/ODwsvTravelFood.aspx", //è«‹æ±‚çš„ç›®æ¨™ URL
      dataType: "json",
      success: function (data) {
        allData = data;
        showData(data);
      },
      error: function () {
        console.log("é€£çµå¤±æ•—");
      },
    });

    function showData(data) {
      console.log(data);
      $("#mydata").empty();

      // Skip this entry if it's missing essential data
      for (let i = 0; i < data.length; i++) {
        if (!data[i] || !data[i].PicURL || !data[i].Name) {
          console.log("Skipping entry", i);
          continue;
        }

        let img = data[i].PicURL;
        let name = data[i].Name;
        let address = data[i].Address;
        let tel = data[i].Tel;
        $("#mydata").append(`
          <div class="card">
            <img src="${img}" class="img-fluid" alt="">
            <div class="card-body">
              <h3 class="card-title">${name}</h3>
              <p class="card-text">ğŸ“ ${address}</p>
              <p class="card-text">ğŸ“ ${tel}</p>
              <button class="map-btn" onclick="openMap('${address}')">å°èˆª</button>
            </div>
          </div>
        `);
      }
    }
    // map function
    function openMap(address) {
      window.open(
        `https://maps.google.com/?q=${encodeURIComponent(address)}`,
        "_blank"
      );
    }
    //add search function
    function searchDestination() {
      let keyword = $("#searchInput").val().trim();
      if (!keyword) {
        showData(allData);
        return;
      }

      let filtered = allData.filter(function (item) {
        let name = item.Name || "";
        let address = item.Address || "";
        return name.includes(keyword) || address.includes(keyword);
      });

      showData(filtered);
    }
  </script>
</html>
